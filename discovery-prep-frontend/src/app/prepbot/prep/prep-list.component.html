<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
  <!-- intro menu -->
  <div class="pb-intro-menu">
    <div class="pb-ui-menu">
      <a href="javascript:" class="pb-menu-dashboard" (click)="changeMode('prep-pop-flow-create')">
        <em class="pb-icon-dataflow"></em>
        Create <strong>Dataflow</strong>
      </a>
      <a href="javascript:" class="pb-menu-create-data" (click)="changeMode('prep-pop-create')">
        <em class="pb-icon-dataset"></em>
        Create <strong>Dataset</strong>
      </a>
      <a href="javascript:" class="pb-menu-manage-data" (click)="changeMode('prep-pop-connection-create')">
        <em class="pb-icon-dataconnection"></em>
        Create <strong>Data Connection</strong>
      </a>
    </div>
  </div>
  <!-- //intro menu -->
  <!-- intro setting -->
  <div class="pb-intro-setting">
    <div class="pb-intro-setting-in">
      <!-- left -->
      <div class="pb-set-left">
        <label class="pb-label-set">Sort by </label>
        <!-- selectbox -->
        <!--
            클릭시 : is-selected 추가
            값 입력시 : is-value 추가

        -->
        <div class="pb-component-selectbox type-white ">
          <span class="pb-txt-selectbox">Recently</span>
          <!-- popup -->
          <div class="pb-select-popup">
            <ul class="pb-list-selectbox">
              <li>
                <a href="javascript:">Recently</a>
              </li>
              <li>
                <a href="javascript:">Name</a>
              </li>
            </ul>
          </div>
          <!-- //popup -->
        </div>
        <!-- //selectbox -->

        <!-- selectbox -->
        <!--
            클릭시 : is-selected 추가
            값 입력시 : is-value 추가

        -->
        <div #selectTypeSelectBox
                class="pb-component-selectbox type-white type-icon-selectbox " [class.is-selected]="isShowSelectType" (click)="isShowSelectType = !isShowSelectType">
          <span class="pb-txt-selectbox"><em class="pb-icon-contents"></em>{{selectType}}</span>
          <!-- popup -->
          <div class="pb-select-popup">
            <ul class="pb-list-selectbox">
              <li>
                <a href="javascript:" (click)="changeSelectType(SelectType.ALL)">ALL</a>
              </li>
              <li>
                <a href="javascript:" (click)="changeSelectType(SelectType.DATAFLOW)">DATA FLOW</a>
              </li>
              <li>
                <a href="javascript:" (click)="changeSelectType(SelectType.DATASETS)">DATA SETS</a>
              </li>
              <li>
                <a href="javascript:" (click)="changeSelectType(SelectType.DATARESULTS)">DATA RESULTS</a>
              </li>
              <li>
                <a href="javascript:" (click)="changeSelectType(SelectType.DATACONNECTION)">DATA CONNECTIONS</a>
              </li>
            </ul>
          </div>
          <!-- //popup -->
        </div>
        <!-- //selectbox -->
      </div>
      <!-- //left -->
      <!-- right -->
      <div class="pb-set-right">
        <ul class="pb-list-toggle">
          <li [class.is-selected]="isCardView" (click)="toggleViewMode(ViewMode.CARD)">
            <a href="javascript:"><em class="pb-icon-grid"></em></a>
          </li>
          <li [class.is-selected]="isListView" (click)="toggleViewMode(ViewMode.LIST)">
            <a href="javascript:"><em class="pb-icon-list"></em></a>
          </li>
        </ul>
        <!-- search -->
        <div class="pb-wrap-search">
          <input type="text" placeholder="Search by title or keyword" [(ngModel)]="searchText" (keypress)="searchDataflows($event);">
        </div>
        <!-- //search -->
      </div>
      <!-- //right -->
    </div>
  </div>
  <!-- //intro setting -->
  <!-- intro contents -->
  <div class="pb-wrap-main pb-clear" *ngIf="isCardView">
    <!--<div class="pb-intro-contents-in" *ngIf="dataflows.length > 0">-->

    <div class="pb-box-main {{isDataresult(item) ? prepCommonUtil.getDataresultStatusClass(item.status) : ''}} ddp-cursor"
         [class.type-dataset]="isDataflow(item)"
         (click)="goToDfDetail(item)"
         *ngFor="let item of list">
      <ng-container *ngIf="isDataflow(item)">
        <!-- main summary -->
        <div class="pb-ui-main-summary type-flow">
          <!-- tag -->
          <div class="pb-ui-tags">
            <span class="pb-component-tag type-type">Dataflow</span>
            <span class="pb-component-tag type-new" *ngIf="item.createdTime | moment: 'isNew'">{{'msg.common.ui.new' | translate}}</span>
          </div>
          <!-- // tag -->
          <div class="pb-ui-graph">
          </div>
          <div class="pb-ui-name ddp-ellipsis" title="{{item.dfName}}">
            {{item.dfName}}
          </div>
          <div class="pb-ui-des ddp-ellipsis" title="{{item.dfDesc}}">
            {{item.dfDesc}}
          </div>
          <!-- num -->
          <div class="pb-data-num">
            <span class="pb-txt-num">
                <em class="pb-file-type type-db"></em>
              {{item.importedDsCount}}
            </span>
            <span class="pb-txt-num">
                <em class="pb-file-type type-dataset"></em>
              {{item.wrangledDsCount}}
            </span>
          </div>
          <!-- //num -->
        </div>
        <!-- //main summary -->
      </ng-container>
      <ng-container *ngIf="isDataset(item)">
        <!-- main summary -->
        <!--<div class="pb-ui-main-summary" [ngStyle]="{'min-height': item.dcImplementor ? '137px' : ''}">-->
        <div class="pb-ui-main-summary">
          <!-- tag -->
          <div class="pb-ui-tags">
            <span class="pb-component-tag type-type">Dataset</span>
            <span class="pb-component-tag type-imported" *ngIf="item.dsType === DsType.IMPORTED">Imported</span>
            <span class="pb-component-tag type-wrangled" *ngIf="item.dsType === DsType.WRANGLED">Wrangled</span>
            <span class="pb-component-tag type-new" *ngIf="item.createdTime | moment: 'isNew'">NEW</span>
          </div>
          <!-- // tag -->
          <div class="pb-ui-name ddp-ellipsis" title="{{item.dsName}}">
            {{item.dsName}}
          </div>
          <div class="pb-ui-des ddp-ellipsis" title="{{item.dsDesc}}">
            {{item.dsDesc}}
          </div>
        </div>
        <!-- //main summary -->
        <!-- data summary -->
        <div class="pb-data-summary">
          <div class="pb-txt-data">
            <span class="pb-data-label">Used in</span>{{item.refDfCount}}
          </div>
          <div class="pb-txt-data">
            {{item.dsType === DsType.IMPORTED ? prepCommonUtil.getDatasetType(item) : item.creatorDfName}}
          </div>
        </div>
        <!-- //data summary -->
      </ng-container>
      <ng-container *ngIf="isDataresult(item)">
        <!-- main summary -->
        <div class="pb-ui-main-summary">
          <!-- result -->
          <div class="pb-ui-result">
            <em class="pb-img-state {{prepCommonUtil.getDataresultStatusClass(item.status)}}"></em>
            <span class="pb-txt-state {{prepCommonUtil.getDataresultStatusClass(item.status)}}">{{item.status}}</span>
            <div class="pb-ui-name ddp-ellipsis" title="{{item.ssName}}">
              {{item.ssName}}
            </div>
            <!--<div class="pb-ui-des ddp-ellipsis" title="{{item.ssDesc}}">-->
              <!--{{item.ssDesc}}-->
            <!--</div>-->
            <div class="pb-ui-time">
              Elapsed time
              <strong><span *ngIf="prepCommonUtil.getElapsedDay(item) > 0">{{prepCommonUtil.getElapsedDay(item) + '일'}}</span>
                {{prepCommonUtil.getElapsedTime(item)}}
              </strong>
            </div>
          </div>
          <!-- //result -->
        </div>
        <!-- //main summary -->
        <!-- data summary -->
        <div class="pb-data-summary">
          <div class="pb-txt-data ddp-ellipsis" title="{{item.dfName}} / {{item.dsName}}">
            <span class="pb-data-label">Dataflow / Dataset</span>{{item.dfName}} / {{item.dsName}}
          </div>
          <div class="pb-txt-data ddp-ellipsis" title="{{getDataresultDestination(item)}}">
            <span class="pb-data-label">Destination</span>{{getDataresultDestination(item)}}
          </div>
        </div>
        <!-- //data summary -->
      </ng-container>
      <ng-container *ngIf="isDataConnection(item)">
        <!-- main summary -->
        <div class="pb-ui-main-summary">
          <!-- tag -->
          <div class="pb-ui-tags">
            <span class="pb-component-tag type-type">Data Connection</span>
            <span class="pb-component-tag type-new" *ngIf="item.createdTime | moment: 'isNew'">NEW</span>
          </div>
          <div class="pb-ui-type" style="min-height: 80px;">
            <span class="pb-wrap-type">
              <em class="pb-img-dataset2 {{prepCommonUtil.getDatabaseIconClass(item.implementor)}}"></em>
            </span>
            <div class="pb-ui-name ddp-ellipsis" title="{{item.name}}">
              {{item.name}}
            </div>
            <div class="pb-ui-des ddp-ellipsis" title="{{item.description}}">
              {{item.description}}
            </div>
          </div>
        </div>
        <!-- //main summary -->
        <!-- data summary -->
        <div class="pb-data-summary">
          <div class="pb-txt-data">
            <span class="pb-data-label">DB Type</span>{{getConnectionImplementorLabel(item.implementor)}}
          </div>
          <div class="pb-txt-data">
            <span class="pb-data-label">Host/Port(URL)</span> {{item.url ? item.url : item.hostname + ' / ' + item.port}}
          </div>
        </div>
        <!-- //data summary -->
      </ng-container>
      <!-- bottom -->
      <div class="pb-box-bottom pb-clear">
        <span class="pb-data-name">
          <em class="pb-img-photo"></em>{{item.modifiedBy.fullName}}
          <!--<img src="{{defaultProfileImageSrc}}" #profileImage>{{item.createdBy.fullName}}-->
        </span>
        <span class="pb-data-calen">
          {{item.modifiedTime | mdate:'YYYY-MM-DD HH:mm'}}
        </span>
      </div>
      <!-- //bottom -->
    </div>

  </div>

  <!-- //list -->
  <div class="pb-intro-contents" *ngIf="isListView">
    <div class="pb-intro-contents-in">

      <!-- new table -->
      <div class="pb-ui-data-expression" *ngIf="list.length > 0">
        <!-- //grid top -->
        <div class="pb-wrap-table">
          <table class="pb-table-grid">
            <colgroup>
              <col width="150px">
              <col width="*">
              <col width="20%">
            </colgroup>
            <thead>
            <tr>
              <th>
                <span class="pb-data-name">Type</span>
              </th>
              <th>
                <span class="pb-data-name">Name</span>
              </th>
              <th>
                <span class="pb-data-name">Modified</span>
              </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of list; let i = index" (click)="goToDfDetail(item)" class="ddp-cursor">
              <ng-container *ngIf="isDataflow(item)">
                <td>
                  DATA FLOW
                </td>
                <td class="ddp-ellipsis">
                  {{item.dfName}}<span>{{item.dfDesc ? ' - ' + item.dfDesc : ''}}</span>
                </td>
              </ng-container>
              <ng-container *ngIf="isDataset(item)">
                <td>
                  DATA SET
                </td>
                <td class="ddp-ellipsis">
                  {{item.dsName}}<span>{{item.dsDesc ? ' - ' + item.dsDesc : ''}}</span>
                </td>
              </ng-container>
              <ng-container *ngIf="isDataresult(item)">
                <td>
                  DATA RESULT
                </td>
                <td class="ddp-ellipsis">
                  {{item.ssName}}<span>{{item.ssDesc ? ' - ' + item.ssDesc : ''}}</span>
                </td>
              </ng-container>
              <ng-container *ngIf="isDataConnection(item)">
                <td>
                  DATA CONNECTION
                </td>
                <td class="ddp-ellipsis">
                  {{item.name}}<span>{{item.description ? ' - ' + item.description : ''}}</span>
                </td>
              </ng-container>
              <td>
                {{item.modifiedTime | mdate:'YYYY-MM-DD HH:mm'}} <span>by</span> {{item.modifiedBy.fullName}}
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- //list -->
  <!-- //intro contents -->
<!-- //intro -->

<!-- 생성 -->
<prep-pop-create *ngIf="mode=='prep-pop-create'"
                        (closeEvent)="changeMode( '' )"
                        (createComplete)="createComplete()"></prep-pop-create>

<prep-pop-flow-create *ngIf="mode=='prep-pop-flow-create'"
                 (closeEvent)="changeMode( '' )"
                 (createComplete)="createComplete()"></prep-pop-flow-create>

<prep-pop-connection-create *ngIf="mode=='prep-pop-connection-create'"
                      (closeEvent)="changeMode( '' )"
                      (createComplete)="createComplete()"></prep-pop-connection-create>

<!-- //생성 -->

<!-- 수정 modify -->
<prep-pop-connection-update *ngIf="mode=='prep-pop-connection-update'" [connectionId]="_selectedDataConnectionId"
                            (closeEvent)="changeMode( '' )"
                            (createComplete)="createComplete()"></prep-pop-connection-update>

<!-- //수정 modify -->