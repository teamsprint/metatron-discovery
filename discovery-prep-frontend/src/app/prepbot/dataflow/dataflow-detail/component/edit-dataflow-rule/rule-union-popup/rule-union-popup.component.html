<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="pb-layout-popup">
  <div class="pb-box-popup">
    <a href="javascript:" class="pb-btn-pop-close" (click)="close()"></a>

    <!-- top -->
    <div class="pb-popup-top">
      <div class="pb-txt-title">{{'msg.dp.ui.union' | translate}}</div>
      <div class="pb-ui-buttons">
        <div class="pb-ui-part">
          <a href="javascript:" class="pb-component-btn type-line" (click)="openPopup()"><em class="pb-icon-add-r"></em>{{'msg.dp.btn.add.ds' | translate}}</a>
        </div>
      </div>
    </div>
    <!-- //top -->

    <!-- contents -->
    <div class="pb-popup-contents pb-pop-create">
      <!-- option -->
      <div class="pb-ui-data-option ">
        <div class="pb-wrap-union">
          <!-- output -->
          <div class="pb-ui-union-output">
            <!-- title -->
            <div class="pb-ui-title">
              {{'msg.dp.ui.union.output' | translate}}
            </div>
            <!-- //title -->

            <!-- total -->
            <div class="pb-data-total">
              <span class="pb-data-num">{{resultFields.length}}</span> {{'msg.dp.ui.columns.in.union' | translate}}
            </div>
            <!-- //total -->

            <!-- 유니온 리스트 -->
            <div class="pb-wrap-union-list">
              <!-- 클릭시 li class="ddp-selected" 추가 -->
              <ul class="pb-list-union" *ngFor="let colInfo of resultFields; let i = index">
                <li>
                  <div class="pb-box-column">
                    <em [ngClass]="getIconType(colInfo.type)"></em>
                    <span class="pb-data-column">{{colInfo.name}}</span>
                    <!--<input type="text" value="Column" class="pb-input-column">
                    <em class="pb-icon-control-edit"></em>-->
                  </div>
                </li>
              </ul>
            </div>
            <!-- //유니온 리스트 -->
          </div>
          <!-- //output -->
          <!-- set -->
          <div class="pb-ui-union-set">
            <!-- title -->
            <div class="pb-ui-title">
              {{'msg.dp.ui.ds.to.union' | translate : {value : unionDatasets.length + 1} }}
            </div>
            <!-- //title -->
            <div class="pb-wrap-union-set">
              <!--
                  매칭이 안되는 컬럼 class="ddp-box-column" 에 ddp-disabled 추가
                  1개 이상의 컬럼이 drop될 경우, 해당 라인에 BG 표시 : tr class="ddp-disabled " 추가
              -->
              <div class="pb-ui-union-table">
                <table class="pb-table-union">
                  <thead>
                  <tr>
                    <th>
                      <div class="pb-wrap-top">
                        <div class="pb-ui-value">
                          <div class="pb-data-value">
                            <strong>{{masterDataset.gridData.fields.length}}</strong>/{{masterDataset.gridData.fields.length}}
                          </div>
                        </div>
                        <span class="pb-data-name" title="{{masterDataset.dsName}}">{{masterDataset.dsName}}</span>
                      </div>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let data of masterDataset.gridData.fields">
                    <td>
                      <div class="pb-box-column">
                        <em [ngClass]="getIconType(data.type)"></em>
                        <span class="pb-data-column">{{data.name}}</span>
                      </div>
                    </td>
                  </tr>
                  </tbody>
                </table>
                <table class="pb-table-union">
                  <thead>
                  <tr>
                    <th *ngFor="let dsItem of unionDatasets" >
                      <div class="pb-wrap-top">
                        <div class="pb-ui-value">
                          <div class="pb-data-value">
                            <strong>{{dsItem.validCount}}</strong>/{{dsItem.gridData ? dsItem.gridData.fields.length : ''}}
                          </div>
                          <em class="ddp-icon-control-cut" (click)="deleteDataset(dsItem)"></em>
                        </div>
                        <span class="pb-data-name" title="{{dsItem.dsName}}">{{dsItem.dsName}}</span>
                      </div>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let fieldList of fieldMatrix" [class.pb-disabled]="isDisableFieldRow(fieldList)">
                    <td *ngFor="let field of fieldList" >
                      <div [ngClass]="{
                            'pb-box-column' : true,
                            'pb-disabled' : 'CORRECT' !== field.unionType
                          }" >
                        <em [ngClass]="getIconType(field.type)"></em>
                        <span class="pb-data-column">{{field.name}}</span>
                      </div>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- //set -->
        </div>
      </div>
      <!-- //option -->
    </div>
    <!-- //contents -->

    <!-- bottom -->
    <div class="pb-popup-bottom">
      <a href="javascript:" class="pb-component-btn-pop type-line" (click)="close()">{{'msg.comm.btn.cancl' | translate}}</a>
      <a href="javascript:" class="pb-component-btn-pop type-bg" (click)="applyRule()"
         [ngClass]="{'ddp-disabled': !isValidUnionState || unionDatasets.length === 0 }" >
        {{'msg.dp.ui.union' | translate}}</a>
    </div>
    <!-- //bottom -->

  </div>
</div>

<app-union-add-datasets
  *ngIf="isAddDatasetsModal"
  [editInfo]="editInfo"
  [existingDatasets]="datasets"
  [dfId]="dfId"
  (complete)="selectedDatasets($event);"
  [masterDsId]="masterDataset.dsId">
</app-union-add-datasets>
