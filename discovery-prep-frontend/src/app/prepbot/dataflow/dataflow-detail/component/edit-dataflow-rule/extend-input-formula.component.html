<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="pb-layout-popup" *ngIf="isShow" (click)="formulaClick($event)">
  <!-- box popup -->
  <div class="pb-box-popup">
    <a href="javascript:" class="pb-btn-pop-close" (click)="close()"></a>
    <!-- top -->
    <div class="pb-popup-top">
      <div class="pb-txt-title">{{'msg.dp.ui.insert.expression' | translate}}</div>

    </div>
    <!-- //top -->
    <!-- contents -->
    <div class="pb-popup-contents pb-pop-create">
      <!-- option -->
      <div class="pb-ui-data-option ">
        <!-- form -->
        <div class="pb-form-option pb-clear" *ngIf="false">
          <label class="pb-label-title">Name</label>
          <div class="pb-component-select-button">
            <div class="pb-form-edit">
              <input type="text" class="pb-component-input" placeholder="Placeholder">
            </div>
          </div>
        </div>
        <!-- //form -->


        <div class="pb-ui-popup-contents page-flex">

          <!-- 계산식 입력 -->
          <div class="pb-ui-accout-textarea">
            <div class="pb-wrap-edit">
              <div #calculationInput (keyup)="calculationInputKeyup()" contentEditable="true" class="pb-ui-edit"></div>
            </div>
            <!-- 메시지 -->
            <div class="pb-ui-message">
              <span class="pb-data-ok" *ngIf="verifyStateFormula == 'S'"><em class="pb-icon-ok"></em>{{'msg.board.custom.ui.val.success' | translate}}</span>
              <span class="pb-data-error" *ngIf="verifyStateFormula == 'F'"><em class="pb-icon-error"></em>{{'msg.board.custom.ui.val.fail' | translate}}</span>
              <!-- disabled : pb-disabled 추가 -->
              <a (click)="verifyFormula()" [ngClass]="{'pb-disabled' : isDisableVerifyButton}"
                 href="javascript:" class="pb-btn-pop pb-bg-black2 " >{{'msg.board.custom.ui.val.check' | translate}}</a>
            </div>
            <!-- //메시지 -->

          </div>
          <!-- //계산식입력 -->

          <!-- 계산식 검색 -->
          <div class="pb-ui-account-search ">
            <div class="pb-clear">

              <div class="pb-label-pop-title">
                {{'msg.board.custom.th.recommendation' | translate}}
              </div>
              <div class="pb-wrap-form-list">
                <!-- add list -->
                <div class="pb-wrap-add-list">
                  <!-- top -->
                  <div class="pb-ui-top">
                    <span class="pb-ui-sub-title">{{'msg.board.custom.th.add.column' | translate}}</span>
                    <!-- sort -->
                    <!-- 클릭시 pb-selected 추가 -->
                    <div class="pb-ui-sort " *ngIf="false">
                      <a href="javascript:" class="pb-icon-sort"></a>
                      <!-- hover -->
                      <div class="pb-ui-tooltip-info">
                        <em class="pb-icon-view-top"></em>
                        정렬순서
                      </div>
                      <!-- //hover -->
                      <!-- popup -->
                      <div class="pb-wrap-popup2">
                        <span class="pb-txt-label2">
                            Order by
                        </span>
                        <ul class="pb-list-popup">
                          <li class="pb-selected">
                            <a href="javascript:">
                              In order of data
                              <em class="pb-icon-check"></em>
                            </a>
                          </li>
                          <li>
                            <a href="javascript:">
                              A-Z
                              <em class="pb-icon-check"></em>
                            </a>
                          </li>
                          <li>
                            <a href="javascript:">
                              Z-A
                              <em class="pb-icon-check"></em>
                            </a>
                          </li>

                        </ul>
                      </div>
                      <!-- //popup -->

                    </div>
                    <!-- //sort -->
                  </div>
                  <!-- //top -->

                  <ul class="pb-list-typebasic pb-typeicon type-page">
                    <li *ngFor="let field of pageFields" (click)="selectField(field)">
                      <a href="javascript:">
                        <em class="pb-icon-type-ab"  *ngIf="field.type === 'STRING' || field.type === 'USER_DEFINED' || field.type === 'TEXT'"></em>
                        <em class="pb-icon-type-local" *ngIf="field.type === 'LNG' || field.type === 'LNT'"></em>
                        <em class="pb-icon-type-calen" *ngIf="field.type === 'TIMESTAMP'"></em>
                        <em class="pb-icon-type-sharp" *ngIf="field.type === 'LONG' || field.type === 'INTEGER' || field.type === 'DOUBLE' || field.type === 'CALCULATED'"></em>
                        <em class="pb-icon-type-tf" *ngIf="field.type === 'BOOLEAN'"></em>
                        <em class="pb-icon-type-array" *ngIf="field.type === 'ARRAY'"></em>
                        <em class="pb-icon-type-map" *ngIf="field.type === 'MAP'"></em>
                        {{field.name}}
                        <em class="pb-icon-type-ab"></em>
                      </a>
                    </li>
                  </ul>
                  <div class="pb-ui-page">
                    <a (click)="prevFieldPage()" [ngClass]="{'ddp-disabled' : currentPage === 1}"
                       href="javascript:" class="pb-btn-prev" ></a>
                    <span class="pb-data-page"><em>{{currentPage}}</em>/<em>{{lastPage}}</em></span>
                    <a (click)="nextFieldPage()" [ngClass]="{'ddp-disabled' : currentPage == lastPage}"
                       href="javascript:" class="pb-btn-next" ></a>
                  </div>

                </div>
                <!-- //add list -->
              </div>
              <!-- formula -->
              <div class="pb-wrap-formula">
                <!-- top -->
                <div class="pb-ui-top">
                  <span class="pb-ui-sub-title">{{'msg.dp.ui.add.expression' | translate}}</span>

                </div>
                <!-- //top -->
                <div class="pb-view-formula type-view">
                  <div class="pb-ui-option">
                    <!-- 검색 -->
                    <!-- focus 시 , 텍스트 입력시 pb-btn-delete : dispaly:block 처리  -->

                    <div class="pb-form-search pb-selected">
                      <em class="pb-icon-search"></em>
                      <input [(ngModel)]="searchFunction" (keyup.esc)="searchFunction = ''"
                             placeholder="{{'msg.dp.ui.add.expression.ph' | translate}}">
                      <em class="pb-btn-search-close" (click)="searchFunction = ''"></em>
                    </div>
                    <!-- //검색 -->
                    <!-- edit -->
                    <div class="pb-wrap-edit3">
                      <label class="pb-label-type">Function category</label>
                      <!-- edit option -->
                      <div class="pb-ui-edit-option">
                        <component-select [array]="totalFunctionCategoryList"
                                          [viewKey]="'label'"
                                          (onSelected)="selectCategory($event)"
                        ></component-select>
                      </div>
                      <!-- //edit option -->

                    </div>
                    <!-- //edit -->
                  </div>

                  <!-- 설명 삭제시  pb-full 추가 -->
                  <div class="pb-ui-formula ">
                    <!-- select box -->
                    <!-- 클릭시 pb-selected 추가 -->

                    <!-- //select box -->
                    <!-- list -->
                    <div class="pb-ui-typebasic" (mouseleave)="setCalculationDescription(null, false)">
                      <div class="pb-ui-dropdown" [ngClass]="{'pb-selected' : true}"
                           *ngFor="let category of functionCategoryList">
                        <span class="pb-list-name">{{category.label}}</span>
                        <ul class="pb-list-typebasic pb-typeplus pb-view">
                          <li [ngClass]="{'pb-selected' : displayDescFunction === funcItem}" *ngFor="let funcItem of category.functions | baseFilter : ['name', searchFunction]"
                              (mouseenter)="setCalculationDescription(funcItem, true)" >
                            <a href="javascript:" (click)="selectFunction(funcItem)">
                              {{funcItem.name}}
                              <em class="pb-icon-plus"></em>
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <!-- list -->


                  </div>
                  <!-- 설명 -->
                  <div class="pb-ui-detail">
                    <!-- empty -->
                    <!-- no data 일때 -->
                    <div class="pb-data-empty" *ngIf="!displayDescFunction else displayDesc;">
                      <div class="pb-data-contents">Select a function</div>
                    </div>
                    <!-- //empty -->
                    <ng-template #displayDesc>
                      <span class="pb-ui-det-title">Description</span>
                      {{displayDescFunction?.description | translate}}
                      <!-- part -->
                      <span class="pb-txt-part" *ngIf="false">
                          <span class="pb-ui-det-title">API</span>
                          DATEDIFF (<span class="pb-data-start">start datetime</span>, <span class="pb-data-end">end datetime</span>)
                          <ul class="pb-list-det">
                              <li><span class="pb-data-start">start datetime</span> 은 시작날짜와 시간입니다.</li>
                              <li><span class="pb-data-end">end datetime</span>은 끝 날짜와 시간입니다.</li>
                          </ul>
                      </span>
                      <!-- //part -->
                      <!-- part -->
                      <span class="pb-txt-part">
                          <span class="pb-ui-det-title">Example</span>
                          <div class="pb-txt-list">
                            {{displayDescFunction?.example}}<br>
                            <ng-container *ngIf="displayDescFunction?.exampleResult">==> </ng-container>{{displayDescFunction?.exampleResult}}
                          </div>
                      </span>
                      <!-- //part -->
                    </ng-template>
                  </div>
                  <!-- //설명 -->
                </div>


              </div>
              <!-- //formula -->
            </div>
          </div>
        </div>
      </div>
      <!-- //option -->






    </div>
    <!-- //contents -->
    <!-- bottom -->
    <div class="pb-popup-bottom">
      <a href="javascript:" class="pb-component-btn-pop type-bg"
         [ngClass]="{'ddp-disabled' : false}" (click)="done($event)">{{'msg.comm.btn.done' | translate}}</a>
      <a href="javascript:" class="pb-component-btn-pop type-dark" *ngIf="false">SAVE</a>
      <a href="javascript:" class="pb-component-btn-pop type-line" (click)="close()">{{'msg.comm.btn.cancl' | translate}}</a>
    </div>
    <!-- //bottom -->
  </div>
  <!-- //box popup -->
</div>
